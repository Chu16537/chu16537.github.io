<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8" />
  <title>blahJob</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* 更現代簡潔的字體 */
      padding: 2em;
      max-width: 800px;
      margin: 2em auto; /* 上下也增加一些外邊距 */
      color: #333; /* 深灰色文字 */
      background-color: #d4d4d4; /* 淺灰色背景 */
    }

    h1 {
      margin-bottom: 1.5em;
      font-size: 2em;
      font-weight: 300; /* 更細的字重 */
      color: #222;
      text-align: center;
    }

    .search-container {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-bottom: 2em; /* 增加下方間距 */
    }

    input {
      width: 300px;
      padding: 0.8em; /* 增加內邊距 */
      font-size: 1em;
      border: 1px solid #ddd; /* 更細的邊框 */
      border-radius: 5px;
      outline: none; /* 移除預設 focus 樣式，稍後自訂 */
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.05); /* 輕微的內陰影 */
    }

    input:focus {
      border-color: #aaa; /* focus 時更明顯的邊框 */
      box-shadow: inset 0 1px 3px rgba(0, 0, 0, 0.1), 0 0 5px rgba(170, 170, 170, 0.3); /* 更明顯的 focus 陰影 */
    }

    button {
      padding: 0.8em; /* 與輸入框相同的內邊距 */
      font-size: 1em;
      margin-left: 0.8em; /* 增加左邊間距 */
      border: none;
      background-color: #eee; /* 淺灰色按鈕 */
      color: #333;
      border-radius: 5px;
      cursor: pointer;
      transition: background-color 0.3s ease; /* 添加過渡效果 */
    }

    button:hover {
      background-color: #ddd;
    }

    button i {
      font-size: 1.2em; /* 放大圖示 */
    }

    .suggestions {
      margin-top: 1em;
      color: #777; /* 更柔和的文字顏色 */
      text-align: left;
    }

    .suggestion-list {
      list-style: none;
      padding: 0;
      margin: 0;
      text-align: left;
      border: 1px solid #eee; /* 建議列表邊框 */
      border-radius: 5px;
      background-color: #fff;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); /* 輕微陰影 */
    }

    .suggestion-item {
      display: block;
      padding: 0.6em 1em;
      cursor: pointer;
      transition: background-color 0.2s ease;
    }

    .suggestion-item:hover {
      background-color: #f0f0f0;
      color: #333;
    }

    .suggestion-item.active {
      background-color: #e0e0e0;
      color: #333;
    }

    #result {
      margin-top: 2em;
    }

    .article {
      margin-bottom: 2em; /* 增加文章間距 */
      padding: 1.5em; /* 增加內邊距 */
      background-color: #fff;
      border-radius: 10px;
      border-top: 0px solid #eee; /* 上邊框保持 1px 細線 */
      border-right: 0px solid #eee; /* 右邊框保持 1px 細線 */
      border-bottom: 0px solid #eee; /* 下邊框保持 1px 細線 */
      border-left: 10px solid #eee; /* 左邊框設定為 10px 粗細 */
      position: relative;
      text-align: left;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05); /* 輕微陰影 */
    }

    .article-action {
      position: absolute;
      top: 0.8em;
      left: 0.8em;
      font-size: 0.9em;
      color: #555;
      background-color: #f0f0f0;
      padding: 0.3em 0.6em;
      border-radius: 4px;
    }

    .article-info {
      text-align: center;
      margin-bottom: 1.2em;
      font-size: 1.1em;
      color: #444;
    }

    .article-rating {
      position: absolute;
      top: 0.8em;
      right: 0.8em;
      font-size: 0.9em;
      color: #444;
      background-color: #f0f0f0;
      padding: 0.3em 0.6em;
      border-radius: 4px;
    }

    .article-feedback {
      margin-top: 1.5em;
      padding: 1em;
      border: 1px solid #ccc; /* 稍淺的黑色邊框 */
      border-radius: 4px;
      background-color: #f9f9f9; /* 更柔和的背景 */
      color: #555;
      font-size: 0.95em;
      line-height: 1.6; /* 增加行高 */
    }

    .green-border { border-color: #a7d1a9 !important; } /* 更柔和的綠色 */
    .red-border { border-color: #e38989 !important; } /* 更柔和的紅色 */
    .blue-border { border-color: #a7b6d1 !important; } /* 更柔和的藍色 */

    #loading {
      text-align: center;
      padding: 1.5em;
      color: #999;
      display: none;
      font-size: 0.9em;
    }

    .title-container {
      text-align: center; /* 將圖片水平置中 */
      margin-bottom: 1.5em; /* 與下方搜尋框保持間距 */
    }

    .title-container img {
      max-width: 300px; /* 設定圖片的最大寬度，防止過大 */
      height: auto; /* 保持圖片的原始比例 */
      display: block; /* 移除圖片底部的額外空間 */
      margin: 0 auto; /* 另一種水平置中的方式 */
    }

    .telegram-link {
      position: fixed; /* 固定在螢幕上的位置 */
      top: 50%;
      right: 2em; /* 距離右邊的距離 */
      transform: translateY(-50%); /* 垂直置中 */
      background-color: #f0f0f0; /* 淺灰色背景 */
      color: #222;
      padding: 0.8em 1em;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      z-index: 100; /* 確保在其他內容之上 */
    }

    .telegram-link a {
      display: flex; /* 讓圖示和文字水平對齊 */
      align-items: center;
      color: inherit; /* 繼承父元素的顏色 */
      text-decoration: none; /* 移除底線 */
    }

    .telegram-link i {
      font-size: 1.5em;
      margin-right: 0.5em;
      color: #0088cc; /* Telegram 的品牌顏色 */
    }

    .telegram-link span {
      font-size: 1em;
    }

    /* 響應式設計調整 */
    @media (max-width: 900px) {
      .telegram-link {
        right: 1em;
      }
    }

    @media (max-width: 700px) {
      .telegram-link {
        display: none; /* 在更小的螢幕上隱藏 */
      }
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
</head>
<body>
  <div class="title-container">
    <img src="/image/title.png" alt="blahJob" />
  </div>
  <div class="search-container">
    <input type="text" id="inputBox" placeholder="輸入公司名稱" oninput="onInputChange()" />
    <button onclick="onConfirm()"><i class="fas fa-search"></i></button>
  </div>
  <div class="suggestions" id="suggestions"></div>
  <div id="result"></div>
  <div id="loading">載入中...</div>
  <div class="telegram-link">
    <a href="https://t.me/blahjob" target="_blank" rel="noopener noreferrer">
      <i class="fab fa-telegram"></i>
      <span></span>
    </a>
  </div>
  <script>
    // JavaScript 程式碼保持不變 (與之前的版本相同)
    let companyMap = {};
    let currentActiveSuggestion = null;
    let currentCompanyId = null;
    let allArticleData = [];
    let loadedArticleCount = 0;
    const articlesPerPage = 5;
    let isLoading = false;

    async function loadCompanyData() {
      const res = await fetch('data/company.json');
      companyMap = await res.json();
    }

    function onInputChange() {
      const keyword = document.getElementById('inputBox').value.trim().toLowerCase();
      const suggestionBox = document.getElementById('suggestions');
      suggestionBox.innerHTML = '';
      if (!keyword) {
        return;
      }
      const matched = Object.keys(companyMap).filter(key => key.includes(keyword));
      if (matched.length > 0) {
        const suggestionList = document.createElement('ul');
        suggestionList.className = 'suggestion-list';
        matched.forEach(item => {
          const li = document.createElement('li');
          li.className = 'suggestion-item';
          li.textContent = item;

          li.addEventListener('mouseenter', () => {
            if (currentActiveSuggestion) {
              currentActiveSuggestion.classList.remove('active');
            }
            li.classList.add('active');
            currentActiveSuggestion = li;
            document.getElementById('inputBox').value = item;
          });

          li.addEventListener('mouseleave', () => {
            li.classList.remove('active');
            currentActiveSuggestion = null;
            if (document.getElementById('inputBox').value !== item && !suggestionList.dataset.clicked) {
              document.getElementById('inputBox').value = document.getElementById('inputBox').dataset.previousValue || '';
            }
            delete suggestionList.dataset.clicked;
          });

          li.addEventListener('click', () => {
            document.getElementById('inputBox').value = item;
            suggestionBox.innerHTML = '';
            document.getElementById('inputBox').focus();
            suggestionList.dataset.clicked = true;
          });

          suggestionList.appendChild(li);
        });
        suggestionBox.appendChild(suggestionList);
        document.getElementById('inputBox').dataset.previousValue = keyword;
      } else {
        suggestionBox.textContent = '無匹配結果';
      }
    }

    async function loadAndDisplayArticles(companyId, startIndex, count) {
      if (isLoading) return;
      isLoading = true;
      document.getElementById('loading').style.display = 'block';
      const resultBox = document.getElementById('result');

      try {
        const res = await fetch(`data/${companyId}.json`);
        const data = await res.json();
        if (!Array.isArray(data)) {
          resultBox.innerHTML = '<p style="color: red;">⚠️ 資料格式錯誤，應為陣列</p>';
          return;
        }
        allArticleData = data;

        const endIndex = Math.min(startIndex + count, allArticleData.length);
        for (let i = startIndex; i < endIndex; i++) {
          const item = allArticleData[i];
          const articleDiv = document.createElement('div');
          articleDiv.className = 'article';

          if (item["本次動作"] === "工作") {
            if (item["當前狀態"] === "在職") {
              articleDiv.classList.add('green-border');
            } else if (item["當前狀態"] === "離職") {
              articleDiv.classList.add('red-border');
            }
          } else if (item["本次動作"] === "面試") {
            articleDiv.classList.add('blue-border');
          }

          const actionSpan = document.createElement('span');
          actionSpan.className = 'article-action';
          actionSpan.textContent = item["本次動作"];
          articleDiv.appendChild(actionSpan);

          const infoDiv = document.createElement('div');
          infoDiv.className = 'article-info';
          infoDiv.textContent = item["職位名稱"];
          if (item["本次動作"] === "工作") {
            infoDiv.textContent += ` (${item["在職/離職日期"]})`;
          } else if (item["本次動作"] === "面試" && item["面試日期"]) {
            infoDiv.textContent += ` (面試日期：${item["面試日期"]})`;
          }
          articleDiv.appendChild(infoDiv);

          if (item["評分"]) {
            const ratingSpan = document.createElement('span');
            ratingSpan.className = 'article-rating';
            ratingSpan.textContent = `評分：${item["評分"]}`;
            articleDiv.appendChild(ratingSpan);
          }

          if (item["心得分享"]) {
            const feedbackDiv = document.createElement('div');
            feedbackDiv.className = 'article-feedback';
            feedbackDiv.textContent = item["心得分享"];
            articleDiv.appendChild(feedbackDiv);
          }

          resultBox.appendChild(articleDiv);
          loadedArticleCount++;
        }

        if (loadedArticleCount < allArticleData.length) {
          document.getElementById('loading').style.display = 'none';
        } else {
          document.getElementById('loading').textContent = '已載入所有資料';
        }
      } catch (err) {
        resultBox.innerHTML += '<p style="color: red;">⚠️ 載入資料失敗，檔案可能不存在</p>';
        console.error(err);
        document.getElementById('loading').style.display = 'none';
      } finally {
        isLoading = false;
      }
    }

    function onConfirm() {
      const input = document.getElementById('inputBox').value.trim();
      const id = companyMap[input];
      const resultBox = document.getElementById('result');
      const suggestionBox = document.getElementById('suggestions');
      resultBox.innerHTML = '';
      allArticleData = [];
      loadedArticleCount = 0;
      document.getElementById('loading').textContent = '載入中...';
      suggestionBox.innerHTML = '';

      if (!id) {
        resultBox.innerHTML = '<p style="color: red;">❌ 找不到對應資料</p>';
        document.getElementById('loading').style.display = 'none';
        currentCompanyId = null;
        return;
      }

      currentCompanyId = id;
      loadAndDisplayArticles(currentCompanyId, 0, articlesPerPage);
    }

    window.addEventListener('scroll', () => {
      if (!currentCompanyId || isLoading) return;

      const { scrollTop, scrollHeight, clientHeight } = document.documentElement;
      if (scrollTop + clientHeight >= scrollHeight - 5) {
        if (loadedArticleCount < allArticleData.length) {
          loadAndDisplayArticles(currentCompanyId, loadedArticleCount, articlesPerPage);
        }
      }
    });

    loadCompanyData();
  </script>
</body>
</html>